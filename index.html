<style>
body{
	margin: 50px;
	font-family: sans-serif;
	font-weight: 100;
}
#reps {
	width:600px;
}
#reps > div{
	border-bottom: 3px dashed #ccc;
	padding-bottom: 50px;
	margin-bottom: 50px;
}
#reps > div:last-child{
	border-bottom: none;
}
#reps > div #profile{ font-size: 25px; }
#reps > div #bills{ font-size: 20px; }
#reps > div #bills li{ margin-bottom: 20px; }
</style>

<div id="reps"></div>

<!-- DO YOUR REPRESENTATIVES REPRESENT YOU? -->
<!-- API Key: 6303a3db19ec449d8678f67b78e9c74d -->

<script src="q.js"></script>
<script src="reqwest.js"></script>
<script>

var repsDOM = document.querySelector("#reps");

function callSunlightAPI(resource,data){
	data = JSON.parse(JSON.stringify(data));
	data.apikey = "6303a3db19ec449d8678f67b78e9c74d";
	return reqwest({
    	url: "https://congress.api.sunlightfoundation.com"+resource,
    	crossOrigin: true,
		data: data
	});
}

function createInfoDOM(rep,bills){

	var html = "";

	// Create profile
	html+="<div id='profile'>"+
			rep.first_name + " " + rep.last_name+
			"<br>"+
			"Sponsored "+bills.count+" bills. Five most recent:"+
		"</div>";

	// Create list of bills
	html+="<div id='bills'>"+
		"<ol>";
	for(var i=0;i<bills.results.length;i++){
		var bill = bills.results[i];
		html+="<li>"+bill.official_title+"<br><br> <span style='font-size:15px'><b>Keywords:</b><br> ";
		for(var j=0;j<bill.keywords.length;j++){
			html += bill.keywords[j];
			if(j<bill.keywords.length-1){ html+=", "; }
		}
		html+="</span></li>";
	}
	html+="</ol>"+
		"</div>";

	// Create the actual DOM
	var dom = document.createElement("div");
	dom.innerHTML = html;
	return dom;

}

function createInfo(rep){
	callSunlightAPI("/bills",{
		sponsor_id: rep.bioguide_id,
		per_page: 5,
		fields: "keywords,official_title"
	})
	.then(function(bills){
		var infoDOM = createInfoDOM(rep,bills);
		console.log(bills);
		repsDOM.appendChild(infoDOM);
	});
}

callSunlightAPI("/legislators/locate",{zip:94030})
.then(function(reps){
	for(var i=0;i<reps.results.length;i++){
		createInfo(reps.results[i]);
	}
});


</script>